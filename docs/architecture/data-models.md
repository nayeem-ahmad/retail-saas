# Data Models

### User

**Purpose:** Represents an individual who can log in and interact with the system, such as a store owner or a cashier.

**Key Attributes:**
- `id`: `UUID` - The unique identifier for the user, generated by Supabase Auth.
- `email`: `string` - The user's email address, used for login.
- `created_at`: `timestamp` - The timestamp when the user account was created.

**TypeScript Interface:**
```typescript
interface User {
  id: string; // UUID
  email: string;
  created_at: string; // ISO 8601 date string
}
```

**Relationships:**
- A `User` can be associated with one or more `Store` entities, managed through a separate `StoreUser` join table to handle roles and permissions.

### Store

**Purpose:** Represents a single retail grocery shop. It acts as the top-level container for most other data, including products, sales, and employees.

**Key Attributes:**
- `id`: `UUID` - The unique identifier for the store.
- `name`: `string` - The legal or display name of the store.
- `address`: `text` - The physical address of the store.
- `owner_id`: `UUID` - A foreign key referencing the `id` of the user who owns the store.

**TypeScript Interface:**
```typescript
interface Store {
  id: string; // UUID
  name: string;
  address: string;
  owner_id: string; // UUID of the User
}
```

**Relationships:**
- **Owns:** A `Store` has one primary `User` (the owner).
- **Has Many:** A `Store` has many `Product`s, `Sale`s, and `Customer`s.
- **Has Many (Through):** A `Store` has many `User`s (employees) through the `StoreUser` join table.

### Product

**Purpose:** Represents an item for sale in a store's inventory.

**Key Attributes:**
- `id`: `UUID` - The unique identifier for the product.
- `store_id`: `UUID` - A foreign key referencing the `Store` this product belongs to.
- `name`: `string` - The display name of the product.
- `price`: `decimal` - The selling price of the product.
- `quantity`: `integer` - The current stock on hand.
- `reorder_level`: `integer` (optional) - The stock level at which to trigger a low-stock alert.
- `sku`: `string` (optional) - The Stock Keeping Unit.

**TypeScript Interface:**
```typescript
interface Product {
  id: string; // UUID
  store_id: string; // UUID
  name: string;
  price: number;
  quantity: number;
  reorder_level?: number;
  sku?: string;
}
```

**Relationships:**
- **Belongs To:** A `Product` belongs to one `Store`.
- **Has Many:** A `Product` can appear in many `Sale` line items.

### Sale

**Purpose:** Represents a single, completed transaction at the Point of Sale.

**Key Attributes:**
- `id`: `UUID` - The unique identifier for the transaction.
- `store_id`: `UUID` - A foreign key referencing the `Store` where the sale occurred.
- `total_amount`: `decimal` - The total value of the sale.
- `created_at`: `timestamp` - The timestamp when the sale was completed.

**TypeScript Interface:**
```typescript
interface Sale {
  id: string; // UUID
  store_id: string; // UUID
  total_amount: number;
  created_at: string; // ISO 8601 date string
}
```

**Relationships:**
- **Belongs To:** A `Sale` belongs to one `Store`.
- **Has Many:** A `Sale` has many `SaleItem`s.

### SaleItem

**Purpose:** Represents a single line item within a `Sale`. It links a `Product` to a `Sale` and records the quantity and price at the time of the transaction.

**Key Attributes:**
- `id`: `UUID` - The unique identifier for the line item.
- `sale_id`: `UUID` - A foreign key referencing the `Sale` this item belongs to.
- `product_id`: `UUID` - A foreign key referencing the `Product` that was sold.
- `quantity`: `integer` - The number of units of the product that were sold.
- `price_at_sale`: `decimal` - The price of a single unit at the time of the sale.

**TypeScript Interface:**
```typescript
interface SaleItem {
  id: string; // UUID
  sale_id: string; // UUID
  product_id: string; // UUID
  quantity: number;
  price_at_sale: number;
}
```

**Relationships:**
- **Belongs To:** A `SaleItem` belongs to one `Sale` and one `Product`.

### Customer

**Purpose:** Represents a customer of the shop, allowing for purchase history tracking and basic CRM functionality.

**Key Attributes:**
- `id`: `UUID` - The unique identifier for the customer.
- `store_id`: `UUID` - A foreign key referencing the `Store` this customer is associated with.
- `name`: `string` - The customer's full name.
- `phone`: `string` (optional) - The customer's phone number.
- `email`: `string` (optional) - The customer's email address.

**TypeScript Interface:**
```typescript
interface Customer {
  id: string; // UUID
  store_id: string; // UUID
  name: string;
  phone?: string;
  email?: string;
}
```

**Relationships:**
- **Belongs To:** A `Customer` belongs to one `Store`.
- **Has Many:** A `Customer` can have many `Sale`s. This relationship can be established by adding an optional `customer_id` to the `Sale` table.

### Supplier

**Purpose:** Represents a vendor or supplier from whom the store purchases goods.

**Key Attributes:**
- `id`: `UUID` - The unique identifier for the supplier.
- `store_id`: `UUID` - A foreign key referencing the `Store` this supplier is associated with.
- `name`: `string` - The supplier's company name.
- `contact_name`: `string` (optional) - The name of the contact person.
- `phone`: `string` (optional) - The supplier's phone number.

**TypeScript Interface:**
```typescript
interface Supplier {
  id: string; // UUID
  store_id: string; // UUID
  name: string;
  contact_name?: string;
  phone?: string;
}
```

**Relationships:**
- **Belongs To:** A `Supplier` is associated with one `Store`.
- **Has Many:** A `Supplier` can be associated with many `Purchase`s.

### Purchase

**Purpose:** Represents a record of stock being added to the inventory from a supplier.

**Key Attributes:**
- `id`: `UUID` - The unique identifier for the purchase record.
- `store_id`: `UUID` - A foreign key referencing the `Store`.
- `product_id`: `UUID` - A foreign key referencing the `Product` being purchased.
- `supplier_id`: `UUID` (optional) - A foreign key referencing the `Supplier`.
- `quantity`: `integer` - The number of units purchased.
- `cost_price`: `decimal` - The cost per unit of the product.
- `purchase_date`: `timestamp` - The date the purchase was made.

**TypeScript Interface:**
```typescript
interface Purchase {
  id: string; // UUID
  store_id: string; // UUID
  product_id: string; // UUID
  supplier_id?: string; // UUID
  quantity: number;
  cost_price: number;
  purchase_date: string; // ISO 8601 date string
}
```

**Relationships:**
- **Belongs To:** A `Purchase` record is associated with one `Store` and one `Product`. It can optionally be linked to a `Supplier`.

### Order

**Purpose:** Represents a customer's order placed through the public e-commerce storefront.

**Key Attributes:**
- `id`: `UUID` - The unique identifier for the order.
- `store_id`: `UUID` - A foreign key referencing the `Store`.
- `customer_id`: `UUID` - A foreign key referencing the `Customer` who placed the order.
- `total_amount`: `decimal` - The total value of the order, including any taxes or shipping.
- `status`: `string` - The current status of the order (e.g., `pending_payment`, `paid`, `processing`, `out_for_delivery`, `delivered`, `cancelled`).
- `delivery_address`: `text` - The full delivery address provided by the customer.
- `created_at`: `timestamp` - The timestamp when the order was placed.

**TypeScript Interface:**
```typescript
type OrderStatus = 'pending_payment' | 'paid' | 'processing' | 'out_for_delivery' | 'delivered' | 'cancelled';

interface Order {
  id: string; // UUID
  store_id: string; // UUID
  customer_id: string; // UUID
  total_amount: number;
  status: OrderStatus;
  delivery_address: string;
  created_at: string; // ISO 8601 date string
}
```

**Relationships:**
- **Belongs To:** An `Order` belongs to one `Store` and one `Customer`.
- **Has Many:** An `Order` has many `OrderItem`s.

### OrderItem

**Purpose:** Represents a single product line item within an `Order`.

**Key Attributes:**
- `id`: `UUID` - The unique identifier for the line item.
- `order_id`: `UUID` - A foreign key referencing the `Order` this item belongs to.
- `product_id`: `UUID` - A foreign key referencing the `Product` that was ordered.
- `quantity`: `integer` - The number of units ordered.
- `price_at_purchase`: `decimal` - The price of a single unit at the time the order was placed.

**TypeScript Interface:**
```typescript
interface OrderItem {
  id: string; // UUID
  order_id: string; // UUID
  product_id: string; // UUID
  quantity: number;
  price_at_purchase: number;
}
```

**Relationships:**
- **Belongs To:** An `OrderItem` belongs to one `Order` and one `Product`.

### BillOfMaterials (BOM)

**Purpose:** Defines the recipe for a manufactured product, listing all the raw materials and components required to produce it.

**Key Attributes:**
- `id`: `UUID` - The unique identifier for the BOM itself.
- `store_id`: `UUID` - A foreign key referencing the `Store`.
- `product_id`: `UUID` - A foreign key referencing the finished `Product` that this BOM describes.

**TypeScript Interface:**
```typescript
interface BillOfMaterials {
  id: string; // UUID
  store_id: string; // UUID
  product_id: string; // UUID of the finished good
}
```

**Relationships:**
- **Belongs To:** A `BillOfMaterials` is associated with one `Store` and one finished `Product`.
- **Has Many:** A `BillOfMaterials` has many `BomItem`s.

### BomItem

**Purpose:** Represents a single line item in a `BillOfMaterials`, specifying one raw material and the quantity required.

**Key Attributes:**
- `id`: `UUID` - The unique identifier for the BOM line item.
- `bom_id`: `UUID` - A foreign key referencing the `BillOfMaterials` this item belongs to.
- `raw_material_id`: `UUID` - A foreign key referencing the `Product` that serves as the raw material.
- `quantity`: `decimal` - The quantity of the raw material required for one unit of the finished good.

**TypeScript Interface:**
```typescript
interface BomItem {
  id: string; // UUID
  bom_id: string; // UUID
  raw_material_id: string; // UUID of a Product
  quantity: number;
}
```

**Relationships:**
- **Belongs To:** A `BomItem` belongs to one `BillOfMaterials` and references one `Product` (as a raw material).

### ProductionOrder

**Purpose:** An instruction to manufacture a specific quantity of a product, which will consume raw materials and create finished goods.

**Key Attributes:**
- `id`: `UUID` - The unique identifier for the production order.
- `store_id`: `UUID` - A foreign key referencing the `Store`.
- `product_id`: `UUID` - A foreign key referencing the `Product` to be manufactured.
- `quantity_to_produce`: `integer` - The target quantity of the finished good.
- `status`: `string` - The current status of the order (e.g., `planned`, `in_progress`, `completed`, `cancelled`).
- `created_at`: `timestamp` - The timestamp when the order was created.
- `completed_at`: `timestamp` (nullable) - The timestamp when the order was completed.

**TypeScript Interface:**
```typescript
type ProductionStatus = 'planned' | 'in_progress' | 'completed' | 'cancelled';

interface ProductionOrder {
  id: string; // UUID
  store_id: string; // UUID
  product_id: string; // UUID of the finished good
  quantity_to_produce: number;
  status: ProductionStatus;
  created_at: string; // ISO 8601 date string
  completed_at?: string; // ISO 8601 date string
}
```

**Relationships:**
- **Belongs To:** A `ProductionOrder` is associated with one `Store` and one `Product`.

### InventoryAdjustment

**Purpose:** Represents a manual adjustment to a product's inventory level, providing an audit trail for changes outside of sales, returns, or purchases.

**Key Attributes:**
- `id`: `UUID` - The unique identifier for the adjustment.
- `store_id`: `UUID` - Foreign key to the `Store`.
- `product_id`: `UUID` - Foreign key to the `Product` being adjusted.
- `user_id`: `UUID` - Foreign key to the `User` who made the adjustment.
- `quantity_changed`: `integer` - The amount the quantity was changed by (can be positive or negative).
- `reason`: `string` - The reason for the adjustment (e.g., `damaged`, `stolen`, `stock_count`, `other`).
- `notes`: `text` (optional) - Additional details about the adjustment.
- `created_at`: `timestamp` - The timestamp when the adjustment was made.

**TypeScript Interface:**
```typescript
type AdjustmentReason = 'damaged' | 'stolen' | 'stock_count' | 'other';

interface InventoryAdjustment {
  id: string; // UUID
  store_id: string; // UUID
  product_id: string; // UUID
  user_id: string; // UUID
  quantity_changed: number;
  reason: AdjustmentReason;
  notes?: string;
  created_at: string; // ISO 8601 date string
}
```

**Relationships:**
- **Belongs To:** An `InventoryAdjustment` belongs to one `Store`, one `Product`, and one `User`.

### SalesReturn

**Purpose:** Represents a record of a customer returning a previously purchased item.

**Key Attributes:**
- `id`: `UUID` - The unique identifier for the sales return.
- `store_id`: `UUID` - Foreign key to the `Store`.
- `original_sale_id`: `UUID` - Foreign key to the original `Sale` transaction.
- `customer_id`: `UUID` (optional) - Foreign key to the `Customer` who made the return.
- `return_date`: `timestamp` - The date the return was processed.
- `total_refund_amount`: `decimal` - The total amount refunded to the customer.
- `status`: `string` - The status of the return (e.g., `requested`, `approved`, `completed`).

**TypeScript Interface:**
```typescript
type SalesReturnStatus = 'requested' | 'approved' | 'completed';

interface SalesReturn {
  id: string; // UUID
  store_id: string; // UUID
  original_sale_id: string; // UUID
  customer_id?: string; // UUID
  return_date: string; // ISO 8601 date string
  total_refund_amount: number;
  status: SalesReturnStatus;
}
```

**Relationships:**
- **Belongs To:** A `SalesReturn` belongs to one `Store` and one `Sale`. It can optionally belong to a `Customer`.
- **Has Many:** A `SalesReturn` has many `SalesReturnItem`s.

### SalesReturnItem

**Purpose:** Represents a single item being returned within a `SalesReturn`.

**Key Attributes:**
- `id`: `UUID` - The unique identifier for the return line item.
- `sales_return_id`: `UUID` - Foreign key to the `SalesReturn`.
- `product_id`: `UUID` - Foreign key to the `Product` being returned.
- `quantity`: `integer` - The number of units returned.
- `reason`: `text` (optional) - The reason for the return.

**TypeScript Interface:**
```typescript
interface SalesReturnItem {
  id: string; // UUID
  sales_return_id: string; // UUID
  product_id: string; // UUID
  quantity: number;
  reason?: string;
}
```

**Relationships:**
- **Belongs To:** A `SalesReturnItem` belongs to one `SalesReturn` and one `Product`.

### PurchaseReturn

**Purpose:** Represents a record of returning goods to a supplier.

**Key Attributes:**
- `id`: `UUID` - The unique identifier for the purchase return.
- `store_id`: `UUID` - Foreign key to the `Store`.
- `original_purchase_id`: `UUID` - Foreign key to the original `Purchase` record.
- `supplier_id`: `UUID` - Foreign key to the `Supplier` the goods are being returned to.
- `return_date`: `timestamp` - The date the return was initiated.
- `total_credit_amount`: `decimal` - The total credit expected from the supplier.
- `status`: `string` - The status of the return (e.g., `shipped`, `received_by_supplier`, `credited`).

**TypeScript Interface:**
```typescript
type PurchaseReturnStatus = 'shipped' | 'received_by_supplier' | 'credited';

interface PurchaseReturn {
  id: string; // UUID
  store_id: string; // UUID
  original_purchase_id: string; // UUID
  supplier_id: string; // UUID
  return_date: string; // ISO 8601 date string
  total_credit_amount: number;
  status: PurchaseReturnStatus;
}
```

**Relationships:**
- **Belongs To:** A `PurchaseReturn` belongs to one `Store`, one `Purchase`, and one `Supplier`.
- **Has Many:** A `PurchaseReturn` has many `PurchaseReturnItem`s.

### PurchaseReturnItem

**Purpose:** Represents a single item being returned within a `PurchaseReturn`.

**Key Attributes:**
- `id`: `UUID` - The unique identifier for the return line item.
- `purchase_return_id`: `UUID` - Foreign key to the `PurchaseReturn`.
- `product_id`: `UUID` - Foreign key to the `Product` being returned.
- `quantity`: `integer` - The number of units returned.
- `reason`: `text` (optional) - The reason for the return.

**TypeScript Interface:**
```typescript
interface PurchaseReturnItem {
  id: string; // UUID
  purchase_return_id: string; // UUID
  product_id: string; // UUID
  quantity: number;
  reason?: string;
}
```

**Relationships:**
- **Belongs To:** A `PurchaseReturnItem` belongs to one `PurchaseReturn` and one `Product`.
