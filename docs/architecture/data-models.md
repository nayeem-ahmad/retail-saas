# Data Models

### User

**Purpose:** Represents an individual who can log in and interact with the system, such as a store owner or a cashier.

**Key Attributes:**
- `id`: `UUID` - The unique identifier for the user, generated by Supabase Auth.
- `email`: `string` - The user's email address, used for login.
- `created_at`: `timestamp` - The timestamp when the user account was created.

**TypeScript Interface:**
```typescript
interface User {
  id: string; // UUID
  email: string;
  created_at: string; // ISO 8601 date string
}
```

**Relationships:**
- A `User` can be associated with one or more `Tenant` entities (as an owner or staff) and specific `Store` entities through join tables to handle roles and permissions.

### Tenant

**Purpose:** Represents the business entity (organization) that subscribes to the SaaS platform. A single tenant can own multiple stores.

**Key Attributes:**
- `id`: `UUID` - The unique identifier for the tenant.
- `owner_id`: `UUID` - Foreign key referencing the `User` who created and owns the tenant account.
- `name`: `string` - The name of the business or organization.
- `created_at`: `timestamp` - The timestamp when the tenant was created.

**TypeScript Interface:**
```typescript
interface Tenant {
  id: string; // UUID
  owner_id: string; // UUID of the User
  name: string;
  created_at: string; // ISO 8601 date string
}
```

**Relationships:**
- **Owns:** A `Tenant` has one primary `User` (the owner).
- **Has Many:** A `Tenant` has many `Store`s.
- **Has One:** A `Tenant` has one active `TenantSubscription`.

### SubscriptionPlan

**Purpose:** Defines the available SaaS pricing tiers (e.g., Basic, Premium).

**Key Attributes:**
- `id`: `UUID` - The unique identifier for the plan.
- `name`: `string` - The name of the plan (e.g., "Basic", "Premium").
- `monthly_price`: `decimal` - The cost per month.
- `features_json`: `jsonb` - A JSON object defining limits and enabled features.

**TypeScript Interface:**
```typescript
interface SubscriptionPlan {
  id: string; // UUID
  name: string;
  monthly_price: number;
  features_json: Record<string, any>;
}
```

**Relationships:**
- **Has Many:** A `SubscriptionPlan` can be linked to many `TenantSubscription`s.

### TenantSubscription

**Purpose:** Tracks the current subscription status and billing cycle for a Tenant.

**Key Attributes:**
- `id`: `UUID` - The unique identifier for the subscription record.
- `tenant_id`: `UUID` - Foreign key referencing the `Tenant`.
- `plan_id`: `UUID` - Foreign key referencing the `SubscriptionPlan`.
- `status`: `string` - The current status (e.g., `active`, `past_due`, `cancelled`).
- `current_period_end`: `timestamp` - When the current billing cycle ends.

**TypeScript Interface:**
```typescript
type SubscriptionStatus = 'active' | 'past_due' | 'cancelled';

interface TenantSubscription {
  id: string; // UUID
  tenant_id: string; // UUID
  plan_id: string; // UUID
  status: SubscriptionStatus;
  current_period_end: string; // ISO 8601 date string
}
```

**Relationships:**
- **Belongs To:** A `TenantSubscription` belongs to one `Tenant` and one `SubscriptionPlan`.

### Store

**Purpose:** Represents a single retail grocery shop. It acts as the container for physical operations, stock, and sales.

**Key Attributes:**
- `id`: `UUID` - The unique identifier for the store.
- `tenant_id`: `UUID` - A foreign key referencing the `Tenant` this store belongs to.
- `name`: `string` - The legal or display name of the store.
- `address`: `text` - The physical address of the store.

**TypeScript Interface:**
```typescript
interface Store {
  id: string; // UUID
  tenant_id: string; // UUID of the Tenant
  name: string;
  address: string;
}
```

**Relationships:**
- **Belongs To:** A `Store` belongs to one `Tenant`.
- **Has Many:** A `Store` has many `Warehouse`s, `Product`s, `Sale`s, and `Customer`s.

### Warehouse

**Purpose:** Represents a physical location where stock is stored (e.g., "Main Storefront", "Back Office", "Off-site Warehouse").

**Key Attributes:**
- `id`: `UUID` - The unique identifier for the warehouse.
- `store_id`: `UUID` - A foreign key referencing the `Store`.
- `name`: `string` - The name of the warehouse.
- `address`: `text` (optional) - The physical location.
- `is_active`: `boolean` - Whether the warehouse is currently operational.

**TypeScript Interface:**
```typescript
interface Warehouse {
  id: string; // UUID
  store_id: string; // UUID
  name: string;
  address?: string;
  is_active: boolean;
}
```

**Relationships:**
- **Belongs To:** A `Warehouse` belongs to one `Store`.
- **Has Many:** A `Warehouse` has many `ProductStock` records and `StockTransfer`s.

### ProductStock

**Purpose:** Tracks the current quantity of a specific product within a specific warehouse.

**Key Attributes:**
- `id`: `UUID` - The unique identifier for the stock record.
- `product_id`: `UUID` - Foreign key to the `Product`.
- `warehouse_id`: `UUID` - Foreign key to the `Warehouse`.
- `quantity`: `integer` - The current stock on hand in this specific warehouse.

**TypeScript Interface:**
```typescript
interface ProductStock {
  id: string; // UUID
  product_id: string; // UUID
  warehouse_id: string; // UUID
  quantity: number;
}
```

**Relationships:**
- **Belongs To:** A `ProductStock` record belongs to one `Product` and one `Warehouse`.

### ProductGroup

**Purpose:** Represents a high-level category for products (e.g., "Beverages", "Electronics").

**Key Attributes:**
- `id`: `UUID` - The unique identifier for the product group.
- `store_id`: `UUID` - A foreign key referencing the `Store`.
- `name`: `string` - The name of the group.
- `description`: `text` (optional) - A brief description of the group.

**TypeScript Interface:**
```typescript
interface ProductGroup {
  id: string; // UUID
  store_id: string; // UUID
  name: string;
  description?: string;
}
```

**Relationships:**
- **Belongs To:** A `ProductGroup` belongs to one `Store`.
- **Has Many:** A `ProductGroup` has many `ProductSubGroup`s and `Product`s.

### ProductSubGroup

**Purpose:** Represents a more specific sub-category within a `ProductGroup` (e.g., "Soft Drinks" under "Beverages").

**Key Attributes:**
- `id`: `UUID` - The unique identifier for the sub-group.
- `store_id`: `UUID` - A foreign key referencing the `Store`.
- `group_id`: `UUID` - A foreign key referencing the parent `ProductGroup`.
- `name`: `string` - The name of the sub-group.

**TypeScript Interface:**
```typescript
interface ProductSubGroup {
  id: string; // UUID
  store_id: string; // UUID
  group_id: string; // UUID
  name: string;
}
```

**Relationships:**
- **Belongs To:** A `ProductSubGroup` belongs to one `Store` and one `ProductGroup`.
- **Has Many:** A `ProductSubGroup` has many `Product`s.

### Product

**Purpose:** Represents an item for sale in a store's inventory.

**Key Attributes:**
- `id`: `UUID` - The unique identifier for the product.
- `store_id`: `UUID` - A foreign key referencing the `Store` this product belongs to.
- `group_id`: `UUID` (optional) - A foreign key referencing the `ProductGroup`.
- `subgroup_id`: `UUID` (optional) - A foreign key referencing the `ProductSubGroup`.
- `name`: `string` - The display name of the product.
- `price`: `decimal` - The selling price of the product.
- `reorder_level`: `integer` (optional) - The stock level at which to trigger a low-stock alert.
- `sku`: `string` (optional) - The Stock Keeping Unit.

**TypeScript Interface:**
```typescript
interface Product {
  id: string; // UUID
  store_id: string; // UUID
  group_id?: string; // UUID
  subgroup_id?: string; // UUID
  name: string;
  price: number;
  reorder_level?: number;
  sku?: string;
}
```

**Relationships:**
- **Belongs To:** A `Product` belongs to one `Store`.
- **Has Many:** A `Product` has many `ProductStock` records (one per warehouse) and can appear in many `Sale` line items.

### Sale

**Purpose:** Represents a single, completed transaction at the Point of Sale.

**Key Attributes:**
- `id`: `UUID` - The unique identifier for the transaction.
- `store_id`: `UUID` - A foreign key referencing the `Store where the sale occurred.
- `customer_id`: `UUID` (optional) - Foreign key to the `Customer`.
- `total_amount`: `decimal` - The total value of all items in the sale.
- `amount_due`: `decimal` - The remaining amount to be paid.
- `status`: `string` - The payment status of the sale (e.g., `due`, `paid`, `void`).
- `created_at`: `timestamp` - The timestamp when the sale was completed.

**TypeScript Interface:**
```typescript
type SaleStatus = 'due' | 'paid' | 'void';

interface Sale {
  id: string; // UUID
  store_id: string; // UUID
  customer_id?: string; // UUID
  total_amount: number;
  amount_due: number;
  status: SaleStatus;
  created_at: string; // ISO 8601 date string
}
```

**Relationships:**
- **Belongs To:** A `Sale` belongs to one `Store`.
- **Has Many:** A `Sale` has many `SaleItem`s and `Payment`s.

### SaleItem

**Purpose:** Represents a single line item within a `Sale`.

**Key Attributes:**
- `id`: `UUID` - The unique identifier for the line item.
- `sale_id`: `UUID` - A foreign key referencing the `Sale`.
- `product_id`: `UUID` - A foreign key referencing the `Product`.
- `warehouse_id`: `UUID` - A foreign key referencing the `Warehouse` from which the stock was deducted.
- `quantity`: `integer` - The number of units sold.
- `price_at_sale`: `decimal` - The price of a single unit at the time of the sale.

**TypeScript Interface:**
```typescript
interface SaleItem {
  id: string; // UUID
  sale_id: string; // UUID
  product_id: string; // UUID
  warehouse_id: string; // UUID
  quantity: number;
  price_at_sale: number;
}
```

**Relationships:**
- **Belongs To:** A `SaleItem` belongs to one `Sale`, one `Product`, and one `Warehouse`.

### Purchase

**Purpose:** Represents a record of stock being added to the inventory from a supplier.

**Key Attributes:**
- `id`: `UUID` - The unique identifier for the purchase record.
- `store_id`: `UUID` - A foreign key referencing the `Store`.
- `product_id`: `UUID` - A foreign key referencing the `Product`.
- `supplier_id`: `UUID` (optional) - A foreign key referencing the `Supplier`.
- `warehouse_id`: `UUID` - A foreign key referencing the `Warehouse` where the stock was added.
- `quantity`: `integer` - The number of units purchased.
- `cost_price`: `decimal` - The cost per unit.
- `purchase_date`: `timestamp` - The date the purchase was made.

**TypeScript Interface:**
```typescript
interface Purchase {
  id: string; // UUID
  store_id: string; // UUID
  product_id: string; // UUID
  supplier_id?: string; // UUID
  warehouse_id: string; // UUID
  quantity: number;
  cost_price: number;
  purchase_date: string; // ISO 8601 date string
}
```

**Relationships:**
- **Belongs To:** A `Purchase` record is associated with one `Store`, one `Product`, one `Supplier`, and one `Warehouse`.

### StockTransfer

**Purpose:** Represents the movement of stock from one warehouse to another.

**Key Attributes:**
- `id`: `UUID` - The unique identifier for the transfer.
- `store_id`: `UUID` - Foreign key to the `Store`.
- `product_id`: `UUID` - Foreign key to the `Product`.
- `from_warehouse_id`: `UUID` - Foreign key to the source `Warehouse`.
- `to_warehouse_id`: `UUID` - Foreign key to the destination `Warehouse`.
- `quantity`: `integer` - The number of units transferred.
- `transfer_date`: `timestamp` - The timestamp when the transfer occurred.
- `user_id`: `UUID` - The user who initiated the transfer.

**TypeScript Interface:**
```typescript
interface StockTransfer {
  id: string; // UUID
  store_id: string; // UUID
  product_id: string; // UUID
  from_warehouse_id: string; // UUID
  to_warehouse_id: string; // UUID
  quantity: number;
  transfer_date: string; // ISO 8601 date string
  user_id: string; // UUID
}
```

**Relationships:**
- **Belongs To:** A `StockTransfer` belongs to one `Store`, one `Product`, and two `Warehouse`s.

### InventoryAdjustment

**Purpose:** Represents a manual adjustment to a product's inventory level within a specific warehouse.

**Key Attributes:**
- `id`: `UUID` - The unique identifier for the adjustment.
- `store_id`: `UUID` - Foreign key to the `Store`.
- `product_id`: `UUID` - Foreign key to the `Product`.
- `warehouse_id`: `UUID` - Foreign key to the `Warehouse` where the adjustment occurred.
- `user_id`: `UUID` - Foreign key to the `User`.
- `quantity_changed`: `integer` - The amount changed (positive or negative).
- `reason`: `string` - (e.g., `damaged`, `stolen`, `stock_count`).
- `created_at`: `timestamp` - The timestamp when the adjustment was made.

**TypeScript Interface:**
```typescript
interface InventoryAdjustment {
  id: string; // UUID
  store_id: string; // UUID
  product_id: string; // UUID
  warehouse_id: string; // UUID
  user_id: string; // UUID
  quantity_changed: number;
  reason: string;
  created_at: string; // ISO 8601 date string
}
```

**Relationships:**
- **Belongs To:** An `InventoryAdjustment` belongs to one `Store`, one `Product`, one `Warehouse`, and one `User`.

### Accounting Module

### AccountGroup

**Purpose:** Represents high-level financial categories (e.g., "Current Assets", "Operating Expenses").

**Key Attributes:**
- `id`: `UUID`
- `tenant_id`: `UUID`
- `name`: `string`
- `type`: `string` (`asset`, `liability`, `equity`, `revenue`, `expense`)

**Relationships:**
- **Belongs To:** A `Tenant`.
- **Has Many:** `AccountSubGroup`s and `Account`s.

### AccountSubGroup

**Purpose:** Represents a more specific classification within an Account Group (e.g., "Cash and Bank" under "Current Assets").

**Key Attributes:**
- `id`: `UUID`
- `tenant_id`: `UUID`
- `group_id`: `UUID` - Foreign key to the parent `AccountGroup`.
- `name`: `string`

**Relationships:**
- **Belongs To:** A `Tenant` and an `AccountGroup`.
- **Has Many:** `Account`s.

### Account

**Purpose:** Represents an entry in the Chart of Accounts (COA) for tracking financial balances.

**Key Attributes:**
- `id`: `UUID`
- `tenant_id`: `UUID`
- `group_id`: `UUID` - Foreign key to the `AccountGroup`.
- `subgroup_id`: `UUID` (optional) - Foreign key to the `AccountSubGroup`.
- `name`: `string` (e.g., "Cash in Hand", "City Bank A/C", "Sales Revenue")
- `category`: `string` (`cash`, `bank`, `general`) - Used to filter for specific voucher types.
- `code`: `string` (optional) - Manual accounting code.

**Relationships:**
- **Belongs To:** A `Tenant`, an `AccountGroup`, and optionally an `AccountSubGroup`.
- **Has Many:** An `Account` appears in many `VoucherDetail` records.

### Voucher

**Purpose:** The header for a double-entry accounting transaction.

**Key Attributes:**
- `id`: `UUID`
- `tenant_id`: `UUID`
- `voucher_number`: `string` (Auto-generated, editable)
- `voucher_type`: `string` (`cash_payment`, `cash_receive`, `bank_payment`, `bank_receive`, `fund_transfer`, `journal`)
- `description`: `text` (The overall narration for the transaction)
- `reference_number`: `string` (Manual reference)
- `date`: `timestamp` (Default: `now()`)

**Relationships:**
- **Belongs To:** A `Tenant`.
- **Has Many:** A `Voucher` has two or more `VoucherDetail` items.

### VoucherDetail

**Purpose:** Represents a single row within a voucher (a debit or credit entry).

**Key Attributes:**
- `id`: `UUID`
- `voucher_id`: `UUID`
- `account_id`: `UUID`
- `debit_amount`: `decimal` (0 if credit)
- `credit_amount`: `decimal` (0 if debit)
- `comment`: `string` (Row-level narration)

**Relationships:**
- **Belongs To:** A `Voucher` and an `Account`.

### HR & Payroll Module

### Department

**Purpose:** Represents a functional area within the tenant's business (e.g., "Sales", "Warehouse", "Admin").

**Key Attributes:**
- `id`: `UUID`
- `tenant_id`: `UUID`
- `name`: `string`

**Relationships:**
- **Belongs To:** A `Tenant`.
- **Has Many:** `Employee`s.

### Designation

**Purpose:** Represents an employee's job title or rank (e.g., "Senior Cashier", "Floor Manager").

**Key Attributes:**
- `id`: `UUID`
- `tenant_id`: `UUID`
- `name`: `string`

**Relationships:**
- **Belongs To:** A `Tenant`.
- **Has Many:** `Employee`s.

### Employee

**Purpose:** Represents a staff member working for the tenant.

**Key Attributes:**
- `id`: `UUID`
- `tenant_id`: `UUID`
- `user_id`: `UUID` (optional) - Links to a `User` if they have system login access.
- `designation_id`: `UUID`
- `department_id`: `UUID`
- `store_id`: `UUID` (optional) - Primary store location.
- `name`: `string`
- `phone`: `string`
- `nid_number`: `string` (National ID for compliance)
- `joining_date`: `date`
- `basic_salary`: `decimal`
- `allowances_json`: `jsonb` - Configurable allowances (House Rent, Medical, etc.).
- `status`: `string` (`active`, `on_leave`, `terminated`)

**Relationships:**
- **Belongs To:** A `Tenant`, `Department`, `Designation`, and optionally a `Store`.
- **Has Many:** `Attendance` records, `LeaveRequest`s, and `SalaryDisbursement`s.

### Admin & Security Module

### Role

**Purpose:** A set of permissions assigned to a group of users (e.g., "Cashier", "Manager").

**Key Attributes:**
- `id`: `UUID`
- `tenant_id`: `UUID`
- `name`: `string`
- `description`: `text` (optional)
- `is_system_role`: `boolean` (Default roles like 'Owner' cannot be edited)

**Relationships:**
- **Belongs To:** A `Tenant`.
- **Has Many (Through):** `User`s via `TenantUser`.
- **Has Many:** `Permission`s.

### Permission

**Purpose:** Defines a specific granular action that can be performed (e.g., `view_cost_price`, `delete_sale`).

**Key Attributes:**
- `id`: `UUID`
- `name`: `string` (e.g., `POS_DISCOUNT_OVERRIDE`)
- `module`: `string` (e.g., `SALES`, `INVENTORY`)
- `description`: `text`

**Relationships:**
- **Belongs To:** Many `Role`s.

### AuditLog

**Purpose:** A permanent record of all critical user actions for fraud prevention and accountability.

**Key Attributes:**
- `id`: `UUID`
- `tenant_id`: `UUID`
- `user_id`: `UUID`
- `action`: `string` (e.g., `UPDATE_PRODUCT_PRICE`)
- `entity_type`: `string` (e.g., `Product`)
- `entity_id`: `UUID`
- `old_values`: `jsonb`
- `new_values`: `jsonb`
- `ip_address`: `string`
- `user_agent`: `string`
- `created_at`: `timestamp`

**Relationships:**
- **Belongs To:** A `Tenant` and a `User`.

### CRM & Loyalty Module

### Customer

**Purpose:** Represents a customer of the tenant, allowing for purchase history tracking, loyalty rewards, and store credit management.

**Key Attributes:**
- `id`: `UUID`
- `tenant_id`: `UUID`
- `name`: `string`
- `phone`: `string` (Unique within tenant)
- `email`: `string` (optional)
- `address`: `text` (optional)
- `segment`: `string` (`new`, `regular`, `vip`, `at_risk`)
- `created_at`: `timestamp`

**Relationships:**
- **Belongs To:** A `Tenant`.
- **Has One:** `CustomerWallet`.
- **Has Many:** `LoyaltyPoint` records, `Sale`s, and `Order`s.

### CustomerWallet

**Purpose:** Manages a customer's store credit balance (prepaid or return credits).

**Key Attributes:**
- `id`: `UUID`
- `customer_id`: `UUID`
- `balance`: `decimal`
- `last_updated`: `timestamp`

**Relationships:**
- **Belongs To:** A `Customer`.

### LoyaltyPoint

**Purpose:** Tracks the points earned or redeemed by a customer.

**Key Attributes:**
- `id`: `UUID`
- `customer_id`: `UUID`
- `sale_id`: `UUID` (optional - if points were earned from a sale)
- `points_earned`: `integer`
- `points_redeemed`: `integer`
- `balance_after`: `integer`
- `description`: `string`

**Relationships:**
- **Belongs To:** A `Customer` and optionally a `Sale`.

### LoyaltyRule

**Purpose:** Defines how points are calculated (e.g., "1 point per 100 BDT").

**Key Attributes:**
- `id`: `UUID`
- `tenant_id`: `UUID`
- `min_spend`: `decimal`
- `points_per_unit`: `integer`
- `redemption_rate`: `decimal` (e.g., 10 points = 1 BDT)
- `is_active`: `boolean`

**Relationships:**
- **Belongs To:** A `Tenant`.

### ... (Other models remain unchanged)
